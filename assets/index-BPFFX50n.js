import{i as Q,g as X,a as Z,b as ee,G as se,r as s,u as W,j as e,L as te,s as ae,c as ne,o as le,d as re,e as k,f as C,h as q,v as G,T as oe,k as P,l as ce,m as $,n as H,p as K,q as V,t as ie,w as de,x as M,y as ue,z as me,B as pe,R as xe,A as F,N as ge,C as he,D as fe}from"./vendor-hPyfbF9i.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))p(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&p(g)}).observe(document,{childList:!0,subtree:!0});function i(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function p(t){if(t.ep)return;t.ep=!0;const l=i(t);fetch(t.href,l)}})();const je={apiKey:"AIzaSyBeabQsYik_Lc-UArmur38vljyNU9oYg6w",authDomain:"chat-app-5e557.firebaseapp.com",projectId:"chat-app-5e557",storageBucket:"chat-app-5e557.appspot.com",messagingSenderId:"196564681764",appId:"1:196564681764:web:1ba57a08420b4e6cd044b1",measurementId:"G-FS61ZGNVND"},B=Q(je),L=X(B),v=Z(B),J=ee(B),we=new se,be="/react-ChatApp/assets/google-Vxclqtie.png",z=()=>{s.useState("");const[n,c]=s.useState(""),[i,p]=s.useState(""),[t,l]=s.useState(""),g=W(),h=async()=>{try{await ae(L,n,i);const d=L.currentUser;d&&g("/"),console.log(d)}catch(d){console.error(d),l("Incorrect email or password")}},w=async()=>{var d;try{await ne(L,we),console.log((d=L==null?void 0:L.currentUser)==null?void 0:d.email)}catch(f){console.error(f)}};return e.jsx("div",{className:"  min-h-screen flex flex-col gap-3  justify-center  ",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg  ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Login"}),e.jsxs("div",{className:"flex flex-col gap-3 p-5 items-center ",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",value:n,onChange:d=>c(d.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",value:i,onChange:d=>p(d.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:h,children:"Login"}),t&&e.jsx("p",{className:"text-red-500",children:t}),e.jsxs("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:["Already have account?",e.jsx(te,{to:"/register",children:"Register"})]}),e.jsx("button",{onClick:w,children:e.jsx("img",{src:be,className:"w-8"})})]})]})})},Ne="/react-ChatApp/assets/man%20(2)-KpudEwK5.png",D=s.createContext(),ye=({children:n})=>{const[c,i]=s.useState({});return s.useEffect(()=>{const p=le(L,t=>{i(t)});return()=>{p()}},[]),e.jsx(D.Provider,{value:{currentUser:c},children:n})},Y="/react-ChatApp/assets/profile-t9qNVa76.jpg",T=s.createContext(),ve=({children:n})=>{const{currentUser:c}=s.useContext(D),i={chatId:"null",user:{}},p=(g,h)=>{switch(h.type){case"CHANGE_USER":return{user:h.payload,chatId:c.uid>h.payload.uid?c.uid+h.payload.uid:h.payload.uid+c.uid};default:return g}},[t,l]=s.useReducer(p,i);return e.jsx(T.Provider,{value:{data:t,dispatch:l},children:n})},Ce=({userData:n,currentTime:c,setUser:i,user:p,handleChats:t,chats:l})=>{const[g,h]=s.useState(null),{currentUser:w}=s.useContext(D),[d,f]=s.useState(""),N=t,{dispatch:I}=s.useContext(T);console.log(w);const a=()=>{h(Y)};console.log(n);const x=o=>{const u=o.target.value;f(u),i(u),N()},j=n.filter(o=>o.uid!==w.uid).filter(o=>o.username.toLowerCase().includes(d.toLowerCase()));console.log(j);const b=d?j:n.filter(o=>o.uid!==w.uid),U=async(o,u)=>{await setDoc(doc(db,"userChats",o),{lastActiveChat:u},{merge:!0})},S=o=>{I({type:"CHANGE_USER",payload:o}),U(w.uid,data.chatId)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" bg-stone-400 bg-opacity-50 flex flex-col max-w-lg  ",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between ",children:[e.jsx("h1",{className:"text-2xl font-bold text-white  ml-6",children:"Chats"}),e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx("div",{children:e.jsx("img",{src:w.photoURL,className:"w-8 rounded-full"})}),e.jsx("button",{onClick:()=>re(L),className:"text-white p-2 bg-slate-400 m-3 rounded-lg h-10 bg-opacity-50 hover:bg-opacity-100  w-20",children:"Logout"})]})]}),e.jsx("input",{type:"text",placeholder:"Search",onChange:x,value:d,className:"m-5 w-auto rounded-md text-center bg-white bg-opacity-50 border-none outline-none ml-15"})]}),e.jsx("div",{className:" chat  sm:w-auto sm:text-sm md:w-auto md:text-md h-auto ",children:e.jsx("div",{className:"flex flex-col justify-start bg-stone-300 bg-opacity-50 w-72 p-2 rounded-md m-2 h-96 overflow-y-scroll",children:b.length>0?Object.entries(l).map(([o,u])=>{var m,y;const r=u.userInfo;return b.some(R=>R.uid===r.uid)?e.jsx("button",{onClick:()=>S(r),children:e.jsxs("div",{className:"flex flex-row justify-between items-center p-2 hover:bg-zinc-500 hover:bg-opacity-50 rounded-md",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx("img",{src:g||r.photoURL,onError:a,className:"w-10 h-10 rounded-full object-cover",alt:r.displayName}),e.jsxs("div",{className:"flex flex-col text-justify item-center p-2",children:[e.jsx("p",{className:"text-white font-bold text-lg",children:r.displayName}),e.jsx("p",{className:"text-white",children:(m=u.lastMessage)==null?void 0:m.inputText})]})]}),e.jsx("p",{className:"text-red-700 text-sm",children:(y=u.lastMessage)==null?void 0:y.times})]})},r.uid):null}):e.jsx("p",{className:"text-white",children:"No user found"})})})]})},_="/react-ChatApp/assets/pdf-DRnJaAAA.png",Ie=({userData:n,currentTime:c,chats:i})=>{const p=c();console.log(p);const{currentUser:t}=s.useContext(D),{data:l,dispatch:g}=s.useContext(T),[h,w]=s.useState([]);s.useState(!1),s.useState(null);const[d,f]=s.useState(null),N=a=>{f(a)},I=()=>{f(null)};return s.useEffect(()=>{const a=async()=>{const j=await k(C(v,"userChats",t.uid));if(j.exists()){const b=j.data().lastActiveChat;b&&g({type:"CHANGE_USER",payload:{chatId:b}})}},x=()=>{const j=q(C(v,"chats",l.chatId),b=>{b.exists()&&w(b.data().messages)});return()=>{j()}};t.uid&&a(),t.uid&&x()},[t.uid,l.chatId,g]),console.log("messages are",h),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"bg-slate-300 mt-3 bg-opacity-50 h-96 p-2 overflow-y-scroll   sm:text-sm md:text-md lg:text-md",children:e.jsx("div",{className:"flex flex-col gap-3",children:h.map(a=>e.jsx("div",{className:`flex ${a.senderId===t.uid?"justify-end":"justify-start"} items-center gap-5`,children:a.senderId===t.uid?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-end",children:[a.inputText!==""&&e.jsx("p",{className:`p-1 w-fit h-auto ${a.senderId===t.uid&&a.inputText!==""?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText||""}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-20 rounded-md mt-2",onClick:()=>N(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]}),e.jsx("img",{src:t.photoURL,className:"w-10 rounded-full",alt:"User avatar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.user.photoURL,className:"w-10 rounded-full",alt:"User avatar"}),e.jsxs("div",{className:"flex flex-col items-start",children:[a.inputText&&e.jsx("div",{className:"",children:e.jsx("p",{className:`p-1 w-auto h-auto ${a.senderId===t.uid?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText})}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-32 rounded-md mt-2",onClick:()=>N(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]})]})},a.id))})}),d&&e.jsxs("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:[e.jsx("img",{src:d,alt:"Enlarged",className:"max-w-full max-h-full"}),e.jsx("button",{onClick:I,className:"absolute top-2 right-2 text-white bg-red-500 px-2 py-1 rounded-md",children:"Close"})]})]})},Ue="/react-ChatApp/assets/send-DkJ6XdFK.png",Se="/react-ChatApp/assets/image--JfwN_-Fz.png",Re="/react-ChatApp/assets/attachment-HcYtqp6r.png",Ae=({currentTime:n})=>{const c=n();console.log(c);const{data:i}=s.useContext(T),[p,t]=s.useState(""),[l,g]=s.useState(null),[h,w]=s.useState(null),{currentUser:d}=s.useContext(D),[f,N]=s.useState("Text"),I=()=>{N(f==="Text"?"Text":f==="Files"?"Files":"Images")},a=async()=>{const u=r=>new Promise((m,y)=>{const R=H(J,G()),E=K(R,r);E.on("state_changed",null,A=>y(A),()=>{V(E.snapshot.ref).then(A=>m(A)).catch(A=>y(A))})});try{let r=null,m=null;h&&(r=await u(h)),l&&(m=await u(l));const y={id:G(),inputText:p,senderId:d.uid,date:oe.now(),time:c,img:r,file:m,fileName:l?l.name:null};await P(C(v,"chats",i.chatId),{messages:ce(y)}),await P(C(v,"userChats",d.uid),{[i.chatId+".lastMessage"]:{inputText:p,times:c},[i.chatId+".data"]:$()}),await P(C(v,"userChats",i.user.uid),{[i.chatId+".lastMessage"]:{inputText:p,times:c},[i.chatId+".data"]:$()}),t(""),w(null),g(null)}catch(r){console.error("Error uploading file: ",r)}},[x,j]=s.useState(null),[b,U]=s.useState(null),S=u=>{const r=u.target.files[0];if(w(r),r){const m=new FileReader;m.onloadend=()=>{j(m.result)},m.readAsDataURL(r)}else j(null)},o=u=>{const r=u.target.files[0];if(g(r),r){const m=new FileReader;m.onloadend=()=>{U(m.result)},m.readAsDataURL(r)}else U(null)};return e.jsx("div",{className:"bg-slate-200 mb-18 bg-opacity-50  p-2  flex flex-row justify-center items-center gap-2",children:e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:p,onChange:u=>{t(u.target.value),I()},placeholder:"Type something here",className:"bg-slate-200 bg-opacity-50 w-1/2 border-none outline-none placeholder-black p-1 rounded-md"}),e.jsx("button",{children:e.jsx("img",{src:Ue,className:"w-8",onClick:a})}),e.jsx("input",{type:"file",accept:"images/*",id:"file",className:"  hidden",onChange:S}),e.jsx("label",{htmlFor:"file",children:x?e.jsx("img",{src:x,className:"w-8",alt:"Image Preview"}):e.jsx("img",{src:Se,className:"w-8",alt:"Image Icon"})}),e.jsx("input",{type:"file",id:"files",accept:".docx,.pdf",className:"hidden",onChange:o}),e.jsx("label",{htmlFor:"files",children:e.jsx("img",{src:l&&l.type==="application/pdf"?_:Re,className:"w-8",alt:"Upload File"})})]})})},Le="/react-ChatApp/assets/video-hBr3jibc.png",De="/react-ChatApp/assets/call-Ds60eEI5.png",Ee=()=>{var U,S;const{currentUser:n}=s.useContext(D),{data:c}=s.useContext(T),[i,p]=s.useState([]),t=ie(v,"Users"),[l,g]=s.useState(null);s.useState("");const[h,w]=s.useState("");console.log("data from auth is",c);const d=h&&i?i.filter(o=>o.uid!==n.uid).filter(o=>o.username.toLowerCase().includes(h.toLowerCase())):[],f=d.length>0?d[0].uid:null;console.log("filtered data",d),s.useEffect(()=>{(async()=>{try{const r=(await de(t)).docs.map(m=>({...m.data(),id:m.id}));p(r),console.log(r)}catch(u){console.log(u)}})()},[]),console.log("userData is",c);const N=()=>{const o=new Date,u=o.getHours(),r=o.getMinutes();let m="AM";u>12&&(m="PM");let y=u%12;y===0&&(y=12);const R=`${y}.${r}${m}`;return console.log(R),R},I=N();console.log("times is printing",I);const a=()=>{g(Y)},[x,j]=s.useState([]);s.useEffect(()=>{const o=()=>{const u=q(C(v,"userChats",n.uid),r=>{j(r.data())});return()=>{u()}};n.uid&&o()},[n.uid]),console.log(n.uid);const b=async()=>{var u,r;if(!f){console.error("User ID is missing or invalid.");return}const o=n.uid>f?n.uid+f:f+n.uid;try{const m=C(v,"chats",o);(await k(m)).exists()||await M(m,{messages:[]});const R={uid:n.uid,displayName:n.displayName,photoURL:n.photoURL},E={uid:f,displayName:((u=d[0])==null?void 0:u.username)||"Unknown User",photoURL:((r=d[0])==null?void 0:r.photoURL)||null};console.log("current userinfo",R),console.log("other userinfo",E);const A=C(v,"userChats",n.uid);(await k(A)).exists()||await M(A,{});const O=C(v,"userChats",f);(await k(O)).exists()||await M(O,{}),await P(A,{[`${o}.userInfo`]:E,[`${o}.date`]:$()}),await P(O,{[`${o}.userInfo`]:R,[`${o}.date`]:$()})}catch(m){console.log("Error updating chats:",m)}};return e.jsx("div",{className:"flex flex-col w-full  gap-0",children:e.jsxs("div",{className:" flex flex-row",children:[e.jsx(Ce,{userData:i,currentTime:N,user:h,setUser:w,handleChats:b,chats:x}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between  bg-zinc-500 bg-opacity-50 p-2  ",children:[e.jsxs("div",{className:"flex flex-row items-center gap-5",children:[e.jsx("img",{src:l||((U=c.user)==null?void 0:U.photoURL),onError:a,className:"w-16  h-16 rounded-full object-cover ",alt:""}),e.jsx("p",{className:"text-white text-2xl font-semibold",children:(S=c.user)==null?void 0:S.displayName})]}),e.jsxs("div",{className:"flex flex-row justify-end gap-3",children:[e.jsx("img",{src:Le,className:"w-8"}),e.jsx("img",{src:De,className:"w-8"})]})]}),e.jsxs("div",{children:[e.jsx(Ie,{userData:i,currentTime:N,chats:x}),e.jsx(Ae,{currentTime:N})]})]})]})})},Fe="/react-ChatApp/assets/addpro-RnIDWnqF.png",Pe=()=>{const[n,c]=s.useState(""),[i,p]=s.useState(""),[t,l]=s.useState(""),[g,h]=s.useState(null),[w,d]=s.useState(""),[f,N]=s.useState(""),I=W(),a=async()=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){console.error("Invalid email address");return}const j=await ue(L,i,t);let b=Ne;if(g){const U=H(J,`uploads/${j.user.uid}/${g.name}`),S=K(U,g);await S,b=await V(S.snapshot.ref)}await me(j.user,{displayName:n,phoneNumber:f,photoURL:b}),console.log("Upload successful",b),await M(C(v,"Users",j.user.uid),{uid:j.user.uid,username:n,email:i,phone:f,password:t,photoURL:b,bio:w}),I("/login"),console.log("Success")}catch(x){console.error("Error:",x)}};return e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Register"}),e.jsxs("div",{className:"flex flex-col gap-2 p-5",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Username",onChange:x=>c(x.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"Email",onChange:x=>p(x.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Phone number",onChange:x=>N(x.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"Password",onChange:x=>l(x.target.value)}),e.jsx("label",{htmlFor:"image-upload",children:e.jsx("img",{src:Fe,className:"w-16",alt:"Add profile picture"})}),e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:x=>h(x.target.files[0])}),e.jsx("textarea",{className:"p-1 bg-slate-300 border-none outline-none resize-none",rows:"2",placeholder:"Add any bio here",onChange:x=>d(x.target.value)}),e.jsx("button",{className:"p-2 bg-slate-500",onClick:a,children:"Register"}),e.jsx("p",{className:"text-black text-opacity-50 hover:text-opacity-100",children:"Already have an account? Login"})]})]})})},Te=()=>{const{currentUser:n,setCurrentUser:c}=s.useContext(D);s.useEffect(()=>{const p=t=>{c(null)};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}},[c]);const i=({children:p})=>n?p:e.jsx(ge,{to:"/login/"});return e.jsx("div",{className:" app flex flex-row gap-0 p-5  w-full h-screen  justify-center items-center",children:e.jsx(pe,{basename:"/react-ChatApp",children:e.jsx(xe,{children:e.jsxs(F,{path:"/",children:[e.jsx(F,{path:"login",element:e.jsx(z,{})}),e.jsx(F,{index:!0,element:e.jsx(i,{children:e.jsx(Ee,{})})}),e.jsx(F,{path:"login",element:e.jsx(z,{})}),e.jsx(F,{path:"register",element:e.jsx(Pe,{})})]})})})})};he.createRoot(document.getElementById("root")).render(e.jsx(ye,{children:e.jsx(ve,{children:e.jsx(fe.StrictMode,{children:e.jsx(Te,{})})})}));
