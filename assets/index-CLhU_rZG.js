import{i as Q,g as X,a as Z,b as ee,G as se,r as s,u as W,j as e,L as te,s as ae,c as ne,o as re,d as le,e as k,f as v,h as q,v as G,T as oe,k as P,l as ce,m as $,n as H,p as K,q as V,t as ie,w as de,x as M,y as ue,z as me,B as pe,R as ge,A as F,N as xe,C as he,D as fe}from"./vendor-hPyfbF9i.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))p(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const x of n.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&p(x)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function p(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();const je={apiKey:"AIzaSyBeabQsYik_Lc-UArmur38vljyNU9oYg6w",authDomain:"chat-app-5e557.firebaseapp.com",projectId:"chat-app-5e557",storageBucket:"chat-app-5e557.appspot.com",messagingSenderId:"196564681764",appId:"1:196564681764:web:1ba57a08420b4e6cd044b1",measurementId:"G-FS61ZGNVND"},B=Q(je),L=X(B),C=Z(B),J=ee(B),we=new se,be="/react-ChatApp/assets/google-Vxclqtie.png",z=()=>{s.useState("");const[r,d]=s.useState(""),[c,p]=s.useState(""),[t,n]=s.useState(""),x=W(),h=async()=>{try{await ae(L,r,c);const i=L.currentUser;i&&x("/"),console.log(i)}catch(i){console.error(i),n("Incorrect email or password")}},w=async()=>{var i;try{await ne(L,we),console.log((i=L==null?void 0:L.currentUser)==null?void 0:i.email)}catch(f){console.error(f)}};return e.jsx("div",{className:"  min-h-screen flex flex-col gap-3  justify-center  ",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg  ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Login"}),e.jsxs("div",{className:"flex flex-col gap-3 p-5 items-center ",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",value:r,onChange:i=>d(i.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",value:c,onChange:i=>p(i.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:h,children:"Login"}),t&&e.jsx("p",{className:"text-red-500",children:t}),e.jsxs("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:["Already have account?",e.jsx(te,{to:"/register",children:"Register"})]}),e.jsx("button",{onClick:w,children:e.jsx("img",{src:be,className:"w-8"})})]})]})})},Ne="/react-ChatApp/assets/man%20(2)-KpudEwK5.png",D=s.createContext(),ye=({children:r})=>{const[d,c]=s.useState({});return s.useEffect(()=>{const p=re(L,t=>{c(t)});return()=>{p()}},[]),e.jsx(D.Provider,{value:{currentUser:d},children:r})},Y="/react-ChatApp/assets/profile-t9qNVa76.jpg",T=s.createContext(),Ce=({children:r})=>{const{currentUser:d}=s.useContext(D),c={chatId:"null",user:{}},p=(x,h)=>{switch(h.type){case"CHANGE_USER":return{user:h.payload,chatId:d.uid>h.payload.uid?d.uid+h.payload.uid:h.payload.uid+d.uid};default:return x}},[t,n]=s.useReducer(p,c);return e.jsx(T.Provider,{value:{data:t,dispatch:n},children:r})},ve=({userData:r,currentTime:d,setUser:c,user:p,handleChats:t,chats:n})=>{const[x,h]=s.useState(null),{currentUser:w}=s.useContext(D),[i,f]=s.useState(""),b=t,{dispatch:I}=s.useContext(T);console.log(w);const a=()=>{h(Y)};console.log(r);const g=l=>{const u=l.target.value;f(u),c(u),b()},j=r.filter(l=>l.uid!==w.uid).filter(l=>l.username.toLowerCase().includes(i.toLowerCase()));console.log(j);const N=i?j:r.filter(l=>l.uid!==w.uid),U=async(l,u)=>{await setDoc(doc(db,"userChats",l),{lastActiveChat:u},{merge:!0})},S=l=>{I({type:"CHANGE_USER",payload:l}),U(w.uid,data.chatId)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" bg-stone-400 bg-opacity-50 flex flex-col max-w-lg  ",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between ",children:[e.jsx("h1",{className:"text-2xl font-bold text-white  ml-6",children:"Chats"}),e.jsx("button",{onClick:()=>le(L),className:"text-white p-2 bg-slate-400 m-3 rounded-lg h-10 bg-opacity-50 hover:bg-opacity-100",children:"Logout"})]}),e.jsx("input",{type:"text",placeholder:"Search",onChange:g,value:i,className:"m-5 w-auto rounded-md text-center bg-white bg-opacity-50 border-none outline-none ml-15"})]}),e.jsx("div",{className:" chat  sm:w-auto sm:text-sm md:w-auto md:text-md h-auto ",children:e.jsx("div",{className:"flex flex-col justify-start bg-stone-300 bg-opacity-50 w-72 p-2 rounded-md m-2 h-96 overflow-y-scroll",children:n&&Object.entries(n).map(([l,u])=>{var m,y;const o=u.userInfo;return N.some(R=>R.uid===o.uid)?e.jsx("button",{onClick:()=>S(o),children:e.jsxs("div",{className:"flex flex-row justify-between items-center p-2 hover:bg-zinc-500 hover:bg-opacity-50 rounded-md",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx("img",{src:x||o.photoURL,onError:a,className:"w-10 rounded-full",alt:""}),e.jsxs("div",{className:"flex flex-col justify-center item-center p-2",children:[e.jsx("p",{className:"text-white font-bold",children:o.displayName}),e.jsx("p",{className:"text-white m-1",children:(m=u.lastMessage)==null?void 0:m.inputText})]})]}),e.jsx("p",{className:"text-red-700 text-sm",children:(y=u.lastMessage)==null?void 0:y.times})]})},o.uid):null})})})]})},_="/react-ChatApp/assets/pdf-DRnJaAAA.png",Ie=({userData:r,currentTime:d,chats:c})=>{const p=d();console.log(p);const{currentUser:t}=s.useContext(D),{data:n,dispatch:x}=s.useContext(T),[h,w]=s.useState([]);s.useState(!1),s.useState(null);const[i,f]=s.useState(null),b=a=>{f(a)},I=()=>{f(null)};return s.useEffect(()=>{const a=async()=>{const j=await k(v(C,"userChats",t.uid));if(j.exists()){const N=j.data().lastActiveChat;N&&x({type:"CHANGE_USER",payload:{chatId:N}})}},g=()=>{const j=q(v(C,"chats",n.chatId),N=>{N.exists()&&w(N.data().messages)});return()=>{j()}};t.uid&&a(),t.uid&&g()},[t.uid,n.chatId,x]),console.log("messages are",h),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"bg-slate-300 mt-3 bg-opacity-50 h-96 p-2 overflow-y-scroll   sm:text-sm md:text-md lg:text-md",children:e.jsx("div",{className:"flex flex-col gap-3",children:h.map(a=>e.jsx("div",{className:`flex ${a.senderId===t.uid?"justify-end":"justify-start"} items-center gap-5`,children:a.senderId===t.uid?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-end",children:[a.inputText!==""&&e.jsx("p",{className:`p-1 w-fit h-auto ${a.senderId===t.uid&&a.inputText!==""?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText||""}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-20 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]}),e.jsx("img",{src:t.photoURL,className:"w-10 rounded-full",alt:"User avatar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.user.photoURL,className:"w-10 rounded-full",alt:"User avatar"}),e.jsxs("div",{className:"flex flex-col items-start",children:[a.inputText&&e.jsx("div",{className:"",children:e.jsx("p",{className:`p-1 w-auto h-auto ${a.senderId===t.uid?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText})}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-32 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]})]})},a.id))})}),i&&e.jsxs("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:[e.jsx("img",{src:i,alt:"Enlarged",className:"max-w-full max-h-full"}),e.jsx("button",{onClick:I,className:"absolute top-2 right-2 text-white bg-red-500 px-2 py-1 rounded-md",children:"Close"})]})]})},Ue="/react-ChatApp/assets/send-DkJ6XdFK.png",Se="/react-ChatApp/assets/image--JfwN_-Fz.png",Re="/react-ChatApp/assets/attachment-HcYtqp6r.png",Ae=({currentTime:r})=>{const d=r();console.log(d);const{data:c}=s.useContext(T),[p,t]=s.useState(""),[n,x]=s.useState(null),[h,w]=s.useState(null),{currentUser:i}=s.useContext(D),[f,b]=s.useState("Text"),I=()=>{b(f==="Text"?"Text":f==="Files"?"Files":"Images")},a=async()=>{const u=o=>new Promise((m,y)=>{const R=H(J,G()),E=K(R,o);E.on("state_changed",null,A=>y(A),()=>{V(E.snapshot.ref).then(A=>m(A)).catch(A=>y(A))})});try{let o=null,m=null;h&&(o=await u(h)),n&&(m=await u(n));const y={id:G(),inputText:p,senderId:i.uid,date:oe.now(),time:d,img:o,file:m,fileName:n?n.name:null};await P(v(C,"chats",c.chatId),{messages:ce(y)}),await P(v(C,"userChats",i.uid),{[c.chatId+".lastMessage"]:{inputText:p,times:d},[c.chatId+".data"]:$()}),await P(v(C,"userChats",c.user.uid),{[c.chatId+".lastMessage"]:{inputText:p,times:d},[c.chatId+".data"]:$()}),t(""),w(null),x(null)}catch(o){console.error("Error uploading file: ",o)}},[g,j]=s.useState(null),[N,U]=s.useState(null),S=u=>{const o=u.target.files[0];if(w(o),o){const m=new FileReader;m.onloadend=()=>{j(m.result)},m.readAsDataURL(o)}else j(null)},l=u=>{const o=u.target.files[0];if(x(o),o){const m=new FileReader;m.onloadend=()=>{U(m.result)},m.readAsDataURL(o)}else U(null)};return e.jsx("div",{className:"bg-slate-200 mb-18 bg-opacity-50  p-2  flex flex-row justify-center items-center gap-2",children:e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:p,onChange:u=>{t(u.target.value),I()},placeholder:"Type something here",className:"bg-slate-200 bg-opacity-50 w-1/2 border-none outline-none placeholder-black p-1 rounded-md"}),e.jsx("button",{children:e.jsx("img",{src:Ue,className:"w-8",onClick:a})}),e.jsx("input",{type:"file",accept:"images/*",id:"file",className:"  hidden",onChange:S}),e.jsx("label",{htmlFor:"file",children:g?e.jsx("img",{src:g,className:"w-8",alt:"Image Preview"}):e.jsx("img",{src:Se,className:"w-8",alt:"Image Icon"})}),e.jsx("input",{type:"file",id:"files",accept:".docx,.pdf",className:"hidden",onChange:l}),e.jsx("label",{htmlFor:"files",children:e.jsx("img",{src:n&&n.type==="application/pdf"?_:Re,className:"w-8",alt:"Upload File"})})]})})},Le="/react-ChatApp/assets/video-hBr3jibc.png",De="/react-ChatApp/assets/call-Ds60eEI5.png",Ee=()=>{var U,S;const{currentUser:r}=s.useContext(D),{data:d}=s.useContext(T),[c,p]=s.useState([]),t=ie(C,"Users"),[n,x]=s.useState(null);s.useState("");const[h,w]=s.useState("");console.log("data from auth is",d);const i=h&&c?c.filter(l=>l.uid!==r.uid).filter(l=>l.username.toLowerCase().includes(h.toLowerCase())):[],f=i.length>0?i[0].uid:null;console.log("filtered data",i),s.useEffect(()=>{(async()=>{try{const o=(await de(t)).docs.map(m=>({...m.data(),id:m.id}));p(o),console.log(o)}catch(u){console.log(u)}})()},[]);const b=()=>{const l=new Date,u=l.getHours(),o=l.getMinutes();let m="AM";u>12&&(m="PM");let y=u%12;y===0&&(y=12);const R=`${y}.${o}${m}`;return console.log(R),R},I=b();console.log("times is printing",I);const a=()=>{x(Y)},[g,j]=s.useState([]);s.useEffect(()=>{const l=()=>{const u=q(v(C,"userChats",r.uid),o=>{j(o.data())});return()=>{u()}};r.uid&&l()},[r.uid]),console.log(r.uid);const N=async()=>{var u,o;if(!f){console.error("User ID is missing or invalid.");return}const l=r.uid>f?r.uid+f:f+r.uid;try{const m=v(C,"chats",l);(await k(m)).exists()||await M(m,{messages:[]});const R={uid:r.uid,displayName:r.displayName,photoURL:r.photoURL},E={uid:f,displayName:((u=i[0])==null?void 0:u.username)||"Unknown User",photoURL:((o=i[0])==null?void 0:o.photoURL)||null};console.log("current userinfo",R),console.log("other userinfo",E);const A=v(C,"userChats",r.uid);(await k(A)).exists()||await M(A,{});const O=v(C,"userChats",f);(await k(O)).exists()||await M(O,{}),await P(A,{[`${l}.userInfo`]:E,[`${l}.date`]:$()}),await P(O,{[`${l}.userInfo`]:R,[`${l}.date`]:$()})}catch(m){console.log("Error updating chats:",m)}};return e.jsx("div",{className:"flex flex-col w-full  gap-0",children:e.jsxs("div",{className:" flex flex-row",children:[e.jsx(ve,{userData:c,currentTime:b,user:h,setUser:w,handleChats:N,chats:g}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between  bg-zinc-500 bg-opacity-50 p-2 ",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:n||((U=d.user)==null?void 0:U.photoURL),onError:a,className:"w-16 rounded-full ",alt:""}),e.jsx("p",{className:"text-white",children:(S=d.user)==null?void 0:S.displayName})]}),e.jsxs("div",{className:"flex flex-row justify-end gap-3",children:[e.jsx("img",{src:Le,className:"w-8"}),e.jsx("img",{src:De,className:"w-8"})]})]}),e.jsxs("div",{children:[e.jsx(Ie,{userData:c,currentTime:b,chats:g}),e.jsx(Ae,{currentTime:b})]})]})]})})},Fe="/react-ChatApp/assets/addpro-RnIDWnqF.png",Pe=()=>{const[r,d]=s.useState(""),[c,p]=s.useState(""),[t,n]=s.useState(""),[x,h]=s.useState(null),[w,i]=s.useState(""),[f,b]=s.useState(""),I=W(),a=async()=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c)){console.error("Invalid email address");return}const j=await ue(L,c,t);let N=Ne;if(x){const U=H(J,`uploads/${j.user.uid}/${x.name}`),S=K(U,x);await S,N=await V(S.snapshot.ref)}await me(j.user,{displayName:r,phoneNumber:f,photoURL:N}),console.log("Upload successful",N),await M(v(C,"Users",j.user.uid),{uid:j.user.uid,username:r,email:c,phone:f,password:t,photoURL:N,bio:w}),I("/login"),console.log("Success")}catch(g){console.error("Error:",g)}};return e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Register"}),e.jsxs("div",{className:"flex flex-col gap-2 p-5",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Username",onChange:g=>d(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"Email",onChange:g=>p(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Phone number",onChange:g=>b(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"Password",onChange:g=>n(g.target.value)}),e.jsx("label",{htmlFor:"image-upload",children:e.jsx("img",{src:Fe,className:"w-16",alt:"Add profile picture"})}),e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:g=>h(g.target.files[0])}),e.jsx("textarea",{className:"p-1 bg-slate-300 border-none outline-none resize-none",rows:"2",placeholder:"Add any bio here",onChange:g=>i(g.target.value)}),e.jsx("button",{className:"p-2 bg-slate-500",onClick:a,children:"Register"}),e.jsx("p",{className:"text-black text-opacity-50 hover:text-opacity-100",children:"Already have an account? Login"})]})]})})},Te=()=>{const{currentUser:r,setCurrentUser:d}=s.useContext(D);s.useEffect(()=>{const p=t=>{d(null)};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}},[d]);const c=({children:p})=>r?p:e.jsx(xe,{to:"/login/"});return e.jsx("div",{className:" app flex flex-row gap-0 p-5  w-full h-screen  justify-center items-center",children:e.jsx(pe,{basename:"/react-ChatApp",children:e.jsx(ge,{children:e.jsxs(F,{path:"/",children:[e.jsx(F,{path:"login",element:e.jsx(z,{})}),e.jsx(F,{index:!0,element:e.jsx(c,{children:e.jsx(Ee,{})})}),e.jsx(F,{path:"login",element:e.jsx(z,{})}),e.jsx(F,{path:"register",element:e.jsx(Pe,{})})]})})})})};he.createRoot(document.getElementById("root")).render(e.jsx(ye,{children:e.jsx(Ce,{children:e.jsx(fe.StrictMode,{children:e.jsx(Te,{})})})}));
