import{i as Y,g as Q,a as X,b as Z,G as ee,r as s,u as z,j as e,L as se,s as te,c as ae,o as ne,d as le,e as k,f as S,h as q,v as G,T as oe,k as F,l as re,m as $,n as H,p as W,q as V,t as ie,w as ce,x as M,y as de,z as ue,B as me,R as ge,A as T,N as pe,C as xe,D as he}from"./vendor-hPyfbF9i.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function h(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();const fe={apiKey:"AIzaSyBeabQsYik_Lc-UArmur38vljyNU9oYg6w",authDomain:"chat-app-5e557.firebaseapp.com",projectId:"chat-app-5e557",storageBucket:"chat-app-5e557.appspot.com",messagingSenderId:"196564681764",appId:"1:196564681764:web:1ba57a08420b4e6cd044b1",measurementId:"G-FS61ZGNVND"},B=Y(fe),L=Q(B),C=X(B),J=Z(B),je=new ee,we="/login/assets/google-Vxclqtie.png",be=()=>{s.useState("");const[l,u]=s.useState(""),[i,h]=s.useState(""),[t,n]=s.useState(""),p=z(),x=async()=>{try{await te(L,l,i);const c=L.currentUser;c&&p("/"),console.log(c)}catch(c){console.error(c),n("Incorrect email or password")}},w=async()=>{var c;try{await ae(L,je),console.log((c=L==null?void 0:L.currentUser)==null?void 0:c.email)}catch(f){console.error(f)}};return e.jsx("div",{className:"  min-h-screen flex flex-col gap-3  justify-center  ",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg  ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Login"}),e.jsxs("div",{className:"flex flex-col gap-3 p-5 items-center ",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",value:l,onChange:c=>u(c.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",value:i,onChange:c=>h(c.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:x,children:"Login"}),t&&e.jsx("p",{className:"text-red-500",children:t}),e.jsxs("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:["Already have account?",e.jsx(se,{to:"/register",children:"Register"})]}),e.jsx("button",{onClick:w,children:e.jsx("img",{src:we,className:"w-8"})})]})]})})},A=s.createContext(),Ne=({children:l})=>{const[u,i]=s.useState({});return s.useEffect(()=>{const h=ne(L,t=>{i(t)});return()=>{h()}},[]),e.jsx(A.Provider,{value:{currentUser:u},children:l})},K="/login/assets/profile-t9qNVa76.jpg",P=s.createContext(),ye=({children:l})=>{const{currentUser:u}=s.useContext(A),i={chatId:"null",user:{}},h=(p,x)=>{switch(x.type){case"CHANGE_USER":return{user:x.payload,chatId:u.uid>x.payload.uid?u.uid+x.payload.uid:x.payload.uid+u.uid};default:return p}},[t,n]=s.useReducer(h,i);return e.jsx(P.Provider,{value:{data:t,dispatch:n},children:l})},ve=({userData:l,currentTime:u,setUser:i,user:h,handleChats:t,chats:n})=>{const[p,x]=s.useState(null),{currentUser:w}=s.useContext(A),[c,f]=s.useState(""),b=t,{dispatch:U}=s.useContext(P);console.log(w);const a=()=>{x(K)};console.log(l);const g=o=>{const d=o.target.value;f(d),i(d),b()},j=l.filter(o=>o.uid!==w.uid).filter(o=>o.username.toLowerCase().includes(c.toLowerCase()));console.log(j);const N=c?j:l.filter(o=>o.uid!==w.uid),I=async(o,d)=>{await setDoc(doc(db,"userChats",o),{lastActiveChat:d},{merge:!0})},v=o=>{U({type:"CHANGE_USER",payload:o}),I(w.uid,data.chatId)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" bg-stone-400 bg-opacity-50 flex flex-col max-w-lg  ",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between ",children:[e.jsx("h1",{className:"text-2xl font-bold text-white  ml-6",children:"Chats"}),e.jsx("button",{onClick:()=>le(L),className:"text-white p-2 bg-slate-400 m-3 rounded-lg h-10 bg-opacity-50 hover:bg-opacity-100",children:"Logout"})]}),e.jsx("input",{type:"text",placeholder:"Search",onChange:g,value:c,className:"m-5 w-auto rounded-md text-center bg-white bg-opacity-50 border-none outline-none ml-15"})]}),e.jsx("div",{className:" chat  sm:w-auto sm:text-sm md:w-auto md:text-md h-auto ",children:e.jsx("div",{className:"flex flex-col justify-start bg-stone-300 bg-opacity-50 w-72 p-2 rounded-md m-2 h-96 overflow-y-scroll",children:n&&Object.entries(n).map(([o,d])=>{var m,y;const r=d.userInfo;return N.some(R=>R.uid===r.uid)?e.jsx("button",{onClick:()=>v(r),children:e.jsxs("div",{className:"flex flex-row justify-between items-center p-2 hover:bg-zinc-500 hover:bg-opacity-50 rounded-md",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx("img",{src:p||r.photoURL,onError:a,className:"w-10 rounded-full",alt:""}),e.jsxs("div",{className:"flex flex-col justify-center item-center p-2",children:[e.jsx("p",{className:"text-white font-bold",children:r.displayName}),e.jsx("p",{className:"text-white m-1",children:(m=d.lastMessage)==null?void 0:m.inputText})]})]}),e.jsx("p",{className:"text-red-700 text-sm",children:(y=d.lastMessage)==null?void 0:y.times})]})},r.uid):null})})})]})},_="/login/assets/pdf-DRnJaAAA.png",Ce=({userData:l,currentTime:u,chats:i})=>{const h=u();console.log(h);const{currentUser:t}=s.useContext(A),{data:n,dispatch:p}=s.useContext(P),[x,w]=s.useState([]);s.useState(!1),s.useState(null);const[c,f]=s.useState(null),b=a=>{f(a)},U=()=>{f(null)};return s.useEffect(()=>{const a=async()=>{const j=await k(S(C,"userChats",t.uid));if(j.exists()){const N=j.data().lastActiveChat;N&&p({type:"CHANGE_USER",payload:{chatId:N}})}},g=()=>{const j=q(S(C,"chats",n.chatId),N=>{N.exists()&&w(N.data().messages)});return()=>{j()}};t.uid&&a(),t.uid&&g()},[t.uid,n.chatId,p]),console.log("messages are",x),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"bg-slate-300 mt-3 bg-opacity-50 h-96 p-2 overflow-y-scroll   sm:text-sm md:text-md lg:text-md",children:e.jsx("div",{className:"flex flex-col gap-3",children:x.map(a=>e.jsx("div",{className:`flex ${a.senderId===t.uid?"justify-end":"justify-start"} items-center gap-5`,children:a.senderId===t.uid?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-end",children:[a.inputText!==""&&e.jsx("p",{className:`p-1 w-fit h-auto ${a.senderId===t.uid&&a.inputText!==""?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText||""}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-20 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]}),e.jsx("img",{src:t.photoURL,className:"w-10 rounded-full",alt:"User avatar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.user.photoURL,className:"w-10 rounded-full",alt:"User avatar"}),e.jsxs("div",{className:"flex flex-col items-start",children:[a.inputText&&e.jsx("div",{className:"",children:e.jsx("p",{className:`p-1 w-auto h-auto ${a.senderId===t.uid?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText})}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-32 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]})]})},a.id))})}),c&&e.jsxs("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:[e.jsx("img",{src:c,alt:"Enlarged",className:"max-w-full max-h-full"}),e.jsx("button",{onClick:U,className:"absolute top-2 right-2 text-white bg-red-500 px-2 py-1 rounded-md",children:"Close"})]})]})},Ie="/login/assets/send-DkJ6XdFK.png",Se="/login/assets/image--JfwN_-Fz.png",Ue="/login/assets/attachment-HcYtqp6r.png",Re=({currentTime:l})=>{const u=l();console.log(u);const{data:i}=s.useContext(P),[h,t]=s.useState(""),[n,p]=s.useState(null),[x,w]=s.useState(null),{currentUser:c}=s.useContext(A),[f,b]=s.useState("Text"),U=()=>{b(f==="Text"?"Text":f==="Files"?"Files":"Images")},a=async()=>{const d=r=>new Promise((m,y)=>{const R=H(J,G()),E=W(R,r);E.on("state_changed",null,D=>y(D),()=>{V(E.snapshot.ref).then(D=>m(D)).catch(D=>y(D))})});try{let r=null,m=null;x&&(r=await d(x)),n&&(m=await d(n));const y={id:G(),inputText:h,senderId:c.uid,date:oe.now(),time:u,img:r,file:m,fileName:n?n.name:null};await F(S(C,"chats",i.chatId),{messages:re(y)}),await F(S(C,"userChats",c.uid),{[i.chatId+".lastMessage"]:{inputText:h,times:u},[i.chatId+".data"]:$()}),await F(S(C,"userChats",i.user.uid),{[i.chatId+".lastMessage"]:{inputText:h,times:u},[i.chatId+".data"]:$()}),t(""),w(null),p(null)}catch(r){console.error("Error uploading file: ",r)}},[g,j]=s.useState(null),[N,I]=s.useState(null),v=d=>{const r=d.target.files[0];if(w(r),r){const m=new FileReader;m.onloadend=()=>{j(m.result)},m.readAsDataURL(r)}else j(null)},o=d=>{const r=d.target.files[0];if(p(r),r){const m=new FileReader;m.onloadend=()=>{I(m.result)},m.readAsDataURL(r)}else I(null)};return e.jsx("div",{className:"bg-slate-200 mb-18 bg-opacity-50  p-2  flex flex-row justify-center items-center gap-2",children:e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:h,onChange:d=>{t(d.target.value),U()},placeholder:"Type something here",className:"bg-slate-200 bg-opacity-50 w-1/2 border-none outline-none placeholder-black p-1 rounded-md"}),e.jsx("button",{children:e.jsx("img",{src:Ie,className:"w-8",onClick:a})}),e.jsx("input",{type:"file",accept:"images/*",id:"file",className:"  hidden",onChange:v}),e.jsx("label",{htmlFor:"file",children:g?e.jsx("img",{src:g,className:"w-8",alt:"Image Preview"}):e.jsx("img",{src:Se,className:"w-8",alt:"Image Icon"})}),e.jsx("input",{type:"file",id:"files",accept:".docx,.pdf",className:"hidden",onChange:o}),e.jsx("label",{htmlFor:"files",children:e.jsx("img",{src:n&&n.type==="application/pdf"?_:Ue,className:"w-8",alt:"Upload File"})})]})})},De="/login/assets/video-hBr3jibc.png",Le="/login/assets/call-Ds60eEI5.png",Ae=()=>{var I,v;const{currentUser:l}=s.useContext(A),{data:u}=s.useContext(P),[i,h]=s.useState([]),t=ie(C,"Users"),[n,p]=s.useState(null);s.useState("");const[x,w]=s.useState("");console.log("data from auth is",u);const c=x&&i?i.filter(o=>o.uid!==l.uid).filter(o=>o.username.toLowerCase().includes(x.toLowerCase())):[],f=c.length>0?c[0].uid:null;console.log("filtered data",c),s.useEffect(()=>{(async()=>{try{const r=(await ce(t)).docs.map(m=>({...m.data(),id:m.id}));h(r),console.log(r)}catch(d){console.log(d)}})()},[]);const b=()=>{const o=new Date,d=o.getHours(),r=o.getMinutes();let m="AM";d>12&&(m="PM");let y=d%12;y===0&&(y=12);const R=`${y}.${r}${m}`;return console.log(R),R},U=b();console.log("times is printing",U);const a=()=>{p(K)},[g,j]=s.useState([]);s.useEffect(()=>{const o=()=>{const d=q(S(C,"userChats",l.uid),r=>{j(r.data())});return()=>{d()}};l.uid&&o()},[l.uid]),console.log(l.uid);const N=async()=>{var d,r;if(!f){console.error("User ID is missing or invalid.");return}const o=l.uid>f?l.uid+f:f+l.uid;try{const m=S(C,"chats",o);(await k(m)).exists()||await M(m,{messages:[]});const R={uid:l.uid,displayName:l.displayName,photoURL:l.photoURL},E={uid:f,displayName:((d=c[0])==null?void 0:d.username)||"Unknown User",photoURL:((r=c[0])==null?void 0:r.photoURL)||null};console.log("current userinfo",R),console.log("other userinfo",E);const D=S(C,"userChats",l.uid);(await k(D)).exists()||await M(D,{});const O=S(C,"userChats",f);(await k(O)).exists()||await M(O,{}),await F(D,{[`${o}.userInfo`]:E,[`${o}.date`]:$()}),await F(O,{[`${o}.userInfo`]:R,[`${o}.date`]:$()})}catch(m){console.log("Error updating chats:",m)}};return e.jsx("div",{className:"flex flex-col w-full  gap-0",children:e.jsxs("div",{className:" flex flex-row",children:[e.jsx(ve,{userData:i,currentTime:b,user:x,setUser:w,handleChats:N,chats:g}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between  bg-zinc-500 bg-opacity-50 p-2 ",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:n||((I=u.user)==null?void 0:I.photoURL),onError:a,className:"w-16 rounded-full ",alt:""}),e.jsx("p",{className:"text-white",children:(v=u.user)==null?void 0:v.displayName})]}),e.jsxs("div",{className:"flex flex-row justify-end gap-3",children:[e.jsx("img",{src:De,className:"w-8"}),e.jsx("img",{src:Le,className:"w-8"})]})]}),e.jsxs("div",{children:[e.jsx(Ce,{userData:i,currentTime:b,chats:g}),e.jsx(Re,{currentTime:b})]})]})]})})},Ee="/login/assets/addpro-RnIDWnqF.png",Fe=()=>{const[l,u]=s.useState(""),[i,h]=s.useState(""),[t,n]=s.useState(""),[p,x]=s.useState(null),[w,c]=s.useState(""),[f,b]=s.useState(""),U=z(),a=async()=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){console.error("Invalid email address");return}const j=await de(L,i,t);if(!p){console.error("Please select a profile picture");return}const N=H(J,`uploads/${j.user.uid}/${p.name}`),I=W(N,p);I.on(v=>{setErr(!0)},()=>{V(I.snapshot.ref).then(async v=>{await ue(j.user,{displayName:l,phoneNumber:f,photoURL:v}),console.log("upload successful",v),await M(S(C,"Users",j.user.uid),{uid:j.user.uid,username:l,email:i,phone:f,password:t,photoURL:v,bio:w})})}),U("/login"),console.log("success")}catch(g){console.log(g)}};return e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Register"}),e.jsxs("div",{className:"flex flex-col gap-2 p-5",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"username",onChange:g=>u(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",onChange:g=>h(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Phone number",onChange:g=>b(g.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",onChange:g=>n(g.target.value)}),e.jsx("label",{htmlFor:"image-upload",children:e.jsx("img",{src:Ee,className:"w-16"})}),e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:g=>x(g.target.files[0])}),e.jsx("textarea",{className:"p-1 bg-slate-300 border-none outline-none resize-none",rows:"2",placeholder:"add any bio here",onChange:g=>c(g.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:a,children:"Register"}),e.jsx("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:"Already have account?Login"})]})]})})},Pe=()=>{const{currentUser:l}=s.useContext(A),u=({children:i})=>l?i:e.jsx(pe,{to:"/login/"});return e.jsx("div",{className:" app flex flex-row gap-0 p-5  w-full h-screen  justify-center items-center",children:e.jsx(me,{children:e.jsx(ge,{children:e.jsxs(T,{path:"/",children:[e.jsx(T,{index:!0,element:e.jsx(u,{children:e.jsx(Ae,{})})}),e.jsx(T,{path:"login",element:e.jsx(be,{})}),e.jsx(T,{path:"register",element:e.jsx(Fe,{})})]})})})})};xe.createRoot(document.getElementById("root")).render(e.jsx(Ne,{children:e.jsx(ye,{children:e.jsx(he.StrictMode,{children:e.jsx(Pe,{})})})}));
