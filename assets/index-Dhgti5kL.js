import{i as Y,g as Q,a as X,b as Z,G as ee,r as s,u as z,j as e,L as se,s as te,c as ae,o as ne,d as re,e as k,f as S,h as q,v as G,T as le,k as F,l as oe,m as $,n as H,p as W,q as V,t as ce,w as ie,x as M,y as de,z as ue,B as me,R as pe,A as T,N as ge,C as xe,D as he}from"./vendor-hPyfbF9i.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&h(g)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function h(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();const fe={apiKey:"AIzaSyBeabQsYik_Lc-UArmur38vljyNU9oYg6w",authDomain:"chat-app-5e557.firebaseapp.com",projectId:"chat-app-5e557",storageBucket:"chat-app-5e557.appspot.com",messagingSenderId:"196564681764",appId:"1:196564681764:web:1ba57a08420b4e6cd044b1",measurementId:"G-FS61ZGNVND"},B=Y(fe),D=Q(B),C=X(B),J=Z(B),je=new ee,we="/react-chatApp/assets/google-Vxclqtie.png",be=()=>{s.useState("");const[r,d]=s.useState(""),[c,h]=s.useState(""),[t,n]=s.useState(""),g=z(),x=async()=>{try{await te(D,r,c),D.currentUser&&g("/"),console.log(currentUser)}catch(u){console.error(u),n("Incorrect email or password")}},w=async()=>{var u;try{await ae(D,je),console.log((u=D==null?void 0:D.currentUser)==null?void 0:u.email)}catch(f){console.error(f)}};return e.jsx("div",{className:"  min-h-screen flex flex-col gap-3  justify-center  ",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg  ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Login"}),e.jsxs("div",{className:"flex flex-col gap-3 p-5 items-center ",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",value:r,onChange:u=>d(u.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",value:c,onChange:u=>h(u.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:x,children:"Login"}),t&&e.jsx("p",{className:"text-red-500",children:t}),e.jsxs("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:["Already have account?",e.jsx(se,{to:"/register",children:"Register"})]}),e.jsx("button",{onClick:w,children:e.jsx("img",{src:we,className:"w-8"})})]})]})})},L=s.createContext(),Ne=({children:r})=>{const[d,c]=s.useState({});return s.useEffect(()=>{const h=ne(D,t=>{c(t)});return()=>{h()}},[]),e.jsx(L.Provider,{value:{currentUser:d},children:r})},K="/react-chatApp/assets/profile-t9qNVa76.jpg",P=s.createContext(),ye=({children:r})=>{const{currentUser:d}=s.useContext(L),c={chatId:"null",user:{}},h=(g,x)=>{switch(x.type){case"CHANGE_USER":return{user:x.payload,chatId:d.uid>x.payload.uid?d.uid+x.payload.uid:x.payload.uid+d.uid};default:return g}},[t,n]=s.useReducer(h,c);return e.jsx(P.Provider,{value:{data:t,dispatch:n},children:r})},ve=({userData:r,currentTime:d,setUser:c,user:h,handleChats:t,chats:n})=>{const[g,x]=s.useState(null),{currentUser:w}=s.useContext(L),[u,f]=s.useState(""),b=t,{dispatch:U}=s.useContext(P);console.log(w);const a=()=>{x(K)};console.log(r);const p=l=>{const i=l.target.value;f(i),c(i),b()},j=r.filter(l=>l.uid!==w.uid).filter(l=>l.username.toLowerCase().includes(u.toLowerCase()));console.log(j);const N=u?j:r.filter(l=>l.uid!==w.uid),I=async(l,i)=>{await setDoc(doc(db,"userChats",l),{lastActiveChat:i},{merge:!0})},v=l=>{U({type:"CHANGE_USER",payload:l}),I(w.uid,data.chatId)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:" bg-stone-400 bg-opacity-50 flex flex-col max-w-lg  ",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between ",children:[e.jsx("h1",{className:"text-2xl font-bold text-white  ml-6",children:"Chats"}),e.jsx("button",{onClick:()=>re(D),className:"text-white p-2 bg-slate-400 m-3 rounded-lg h-10 bg-opacity-50 hover:bg-opacity-100",children:"Logout"})]}),e.jsx("input",{type:"text",placeholder:"Search",onChange:p,value:u,className:"m-5 w-auto rounded-md text-center bg-white bg-opacity-50 border-none outline-none ml-15"})]}),e.jsx("div",{className:" chat  sm:w-auto sm:text-sm md:w-auto md:text-md h-auto ",children:e.jsx("div",{className:"flex flex-col justify-start bg-stone-300 bg-opacity-50 w-72 p-2 rounded-md m-2 h-96 overflow-y-scroll",children:n&&Object.entries(n).map(([l,i])=>{var m,y;const o=i.userInfo;return N.some(R=>R.uid===o.uid)?e.jsx("button",{onClick:()=>v(o),children:e.jsxs("div",{className:"flex flex-row justify-between items-center p-2 hover:bg-zinc-500 hover:bg-opacity-50 rounded-md",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx("img",{src:g||o.photoURL,onError:a,className:"w-10 rounded-full",alt:""}),e.jsxs("div",{className:"flex flex-col justify-center item-center p-2",children:[e.jsx("p",{className:"text-white font-bold",children:o.displayName}),e.jsx("p",{className:"text-white m-1",children:(m=i.lastMessage)==null?void 0:m.inputText})]})]}),e.jsx("p",{className:"text-red-700 text-sm",children:(y=i.lastMessage)==null?void 0:y.times})]})},o.uid):null})})})]})},_="/react-chatApp/assets/pdf-DRnJaAAA.png",Ce=({userData:r,currentTime:d,chats:c})=>{const h=d();console.log(h);const{currentUser:t}=s.useContext(L),{data:n,dispatch:g}=s.useContext(P),[x,w]=s.useState([]);s.useState(!1),s.useState(null);const[u,f]=s.useState(null),b=a=>{f(a)},U=()=>{f(null)};return s.useEffect(()=>{const a=async()=>{const j=await k(S(C,"userChats",t.uid));if(j.exists()){const N=j.data().lastActiveChat;N&&g({type:"CHANGE_USER",payload:{chatId:N}})}},p=()=>{const j=q(S(C,"chats",n.chatId),N=>{N.exists()&&w(N.data().messages)});return()=>{j()}};t.uid&&a(),t.uid&&p()},[t.uid,n.chatId,g]),console.log("messages are",x),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"bg-slate-300 mt-3 bg-opacity-50 h-96 p-2 overflow-y-scroll   sm:text-sm md:text-md lg:text-md",children:e.jsx("div",{className:"flex flex-col gap-3",children:x.map(a=>e.jsx("div",{className:`flex ${a.senderId===t.uid?"justify-end":"justify-start"} items-center gap-5`,children:a.senderId===t.uid?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-end",children:[a.inputText!==""&&e.jsx("p",{className:`p-1 w-fit h-auto ${a.senderId===t.uid&&a.inputText!==""?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText||""}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-20 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]}),e.jsx("img",{src:t.photoURL,className:"w-10 rounded-full",alt:"User avatar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.user.photoURL,className:"w-10 rounded-full",alt:"User avatar"}),e.jsxs("div",{className:"flex flex-col items-start",children:[a.inputText&&e.jsx("div",{className:"",children:e.jsx("p",{className:`p-1 w-auto h-auto ${a.senderId===t.uid?"bg-blue-500 text-white rounded-l-xl rounded-br-xl pl-4 pr-2":"bg-white text-black rounded-r-xl rounded-bl-xl pl-4 pr-2"}`,children:a.inputText})}),a.img&&e.jsx("img",{src:a.img,alt:"Uploaded",className:"w-32 rounded-md mt-2",onClick:()=>b(a.img)}),a.file&&e.jsxs("div",{className:"bg-slate-300 bg-opacity-50 p-3 rounded-lg",children:[a.fileName.endsWith(".pdf")?e.jsx("img",{src:_,alt:"PDF Icon",className:"w-8 mr-2"}):null,e.jsx("a",{href:a.file,target:"_blank",rel:"noopener noreferrer",className:"text-white mt-2 underline",children:a.fileName||"File"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.time})]})]})},a.id))})}),u&&e.jsxs("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:[e.jsx("img",{src:u,alt:"Enlarged",className:"max-w-full max-h-full"}),e.jsx("button",{onClick:U,className:"absolute top-2 right-2 text-white bg-red-500 px-2 py-1 rounded-md",children:"Close"})]})]})},Ie="/react-chatApp/assets/send-DkJ6XdFK.png",Se="/react-chatApp/assets/image--JfwN_-Fz.png",Ue="/react-chatApp/assets/attachment-HcYtqp6r.png",Re=({currentTime:r})=>{const d=r();console.log(d);const{data:c}=s.useContext(P),[h,t]=s.useState(""),[n,g]=s.useState(null),[x,w]=s.useState(null),{currentUser:u}=s.useContext(L),[f,b]=s.useState("Text"),U=()=>{b(f==="Text"?"Text":f==="Files"?"Files":"Images")},a=async()=>{const i=o=>new Promise((m,y)=>{const R=H(J,G()),E=W(R,o);E.on("state_changed",null,A=>y(A),()=>{V(E.snapshot.ref).then(A=>m(A)).catch(A=>y(A))})});try{let o=null,m=null;x&&(o=await i(x)),n&&(m=await i(n));const y={id:G(),inputText:h,senderId:u.uid,date:le.now(),time:d,img:o,file:m,fileName:n?n.name:null};await F(S(C,"chats",c.chatId),{messages:oe(y)}),await F(S(C,"userChats",u.uid),{[c.chatId+".lastMessage"]:{inputText:h,times:d},[c.chatId+".data"]:$()}),await F(S(C,"userChats",c.user.uid),{[c.chatId+".lastMessage"]:{inputText:h,times:d},[c.chatId+".data"]:$()}),t(""),w(null),g(null)}catch(o){console.error("Error uploading file: ",o)}},[p,j]=s.useState(null),[N,I]=s.useState(null),v=i=>{const o=i.target.files[0];if(w(o),o){const m=new FileReader;m.onloadend=()=>{j(m.result)},m.readAsDataURL(o)}else j(null)},l=i=>{const o=i.target.files[0];if(g(o),o){const m=new FileReader;m.onloadend=()=>{I(m.result)},m.readAsDataURL(o)}else I(null)};return e.jsx("div",{className:"bg-slate-200 mb-18 bg-opacity-50  p-2  flex flex-row justify-center items-center gap-2",children:e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:h,onChange:i=>{t(i.target.value),U()},placeholder:"Type something here",className:"bg-slate-200 bg-opacity-50 w-1/2 border-none outline-none placeholder-black p-1 rounded-md"}),e.jsx("button",{children:e.jsx("img",{src:Ie,className:"w-8",onClick:a})}),e.jsx("input",{type:"file",accept:"images/*",id:"file",className:"  hidden",onChange:v}),e.jsx("label",{htmlFor:"file",children:p?e.jsx("img",{src:p,className:"w-8",alt:"Image Preview"}):e.jsx("img",{src:Se,className:"w-8",alt:"Image Icon"})}),e.jsx("input",{type:"file",id:"files",accept:".docx,.pdf",className:"hidden",onChange:l}),e.jsx("label",{htmlFor:"files",children:e.jsx("img",{src:n&&n.type==="application/pdf"?_:Ue,className:"w-8",alt:"Upload File"})})]})})},Ae="/react-chatApp/assets/video-hBr3jibc.png",De="/react-chatApp/assets/call-Ds60eEI5.png",Le=()=>{var I,v;const{currentUser:r}=s.useContext(L),{data:d}=s.useContext(P),[c,h]=s.useState([]),t=ce(C,"Users"),[n,g]=s.useState(null);s.useState("");const[x,w]=s.useState("");console.log("data from auth is",d);const u=x&&c?c.filter(l=>l.uid!==r.uid).filter(l=>l.username.toLowerCase().includes(x.toLowerCase())):[],f=u.length>0?u[0].uid:null;console.log("filtered data",u),s.useEffect(()=>{(async()=>{try{const o=(await ie(t)).docs.map(m=>({...m.data(),id:m.id}));h(o),console.log(o)}catch(i){console.log(i)}})()},[]);const b=()=>{const l=new Date,i=l.getHours(),o=l.getMinutes();let m="AM";i>12&&(m="PM");let y=i%12;y===0&&(y=12);const R=`${y}.${o}${m}`;return console.log(R),R},U=b();console.log("times is printing",U);const a=()=>{g(K)},[p,j]=s.useState([]);s.useEffect(()=>{const l=()=>{const i=q(S(C,"userChats",r.uid),o=>{j(o.data())});return()=>{i()}};r.uid&&l()},[r.uid]),console.log(r.uid);const N=async()=>{var i,o;if(!f){console.error("User ID is missing or invalid.");return}const l=r.uid>f?r.uid+f:f+r.uid;try{const m=S(C,"chats",l);(await k(m)).exists()||await M(m,{messages:[]});const R={uid:r.uid,displayName:r.displayName,photoURL:r.photoURL},E={uid:f,displayName:((i=u[0])==null?void 0:i.username)||"Unknown User",photoURL:((o=u[0])==null?void 0:o.photoURL)||null};console.log("current userinfo",R),console.log("other userinfo",E);const A=S(C,"userChats",r.uid);(await k(A)).exists()||await M(A,{});const O=S(C,"userChats",f);(await k(O)).exists()||await M(O,{}),await F(A,{[`${l}.userInfo`]:E,[`${l}.date`]:$()}),await F(O,{[`${l}.userInfo`]:R,[`${l}.date`]:$()})}catch(m){console.log("Error updating chats:",m)}};return e.jsx("div",{className:"flex flex-col w-full  gap-0",children:e.jsxs("div",{className:" flex flex-row",children:[e.jsx(ve,{userData:c,currentTime:b,user:x,setUser:w,handleChats:N,chats:p}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex flex-row items-center  justify-between  bg-zinc-500 bg-opacity-50 p-2 ",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("img",{src:n||((I=d.user)==null?void 0:I.photoURL),onError:a,className:"w-16 rounded-full ",alt:""}),e.jsx("p",{className:"text-white",children:(v=d.user)==null?void 0:v.displayName})]}),e.jsxs("div",{className:"flex flex-row justify-end gap-3",children:[e.jsx("img",{src:Ae,className:"w-8"}),e.jsx("img",{src:De,className:"w-8"})]})]}),e.jsxs("div",{children:[e.jsx(Ce,{userData:c,currentTime:b,chats:p}),e.jsx(Re,{currentTime:b})]})]})]})})},Ee="/react-chatApp/assets/addpro-RnIDWnqF.png",Fe=()=>{const[r,d]=s.useState(""),[c,h]=s.useState(""),[t,n]=s.useState(""),[g,x]=s.useState(null),[w,u]=s.useState(""),[f,b]=s.useState(""),U=z(),a=async()=>{try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c)){console.error("Invalid email address");return}const j=await de(D,c,t);if(!g){console.error("Please select a profile picture");return}const N=H(J,`uploads/${j.user.uid}/${g.name}`),I=W(N,g);I.on(v=>{setErr(!0)},()=>{V(I.snapshot.ref).then(async v=>{await ue(j.user,{displayName:r,phoneNumber:f,photoURL:v}),console.log("upload successful",v),await M(S(C,"Users",j.user.uid),{uid:j.user.uid,username:r,email:c,phone:f,password:t,photoURL:v,bio:w})})}),U("/login"),console.log("success")}catch(p){console.log(p)}};return e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:" bg-slate-400 p-5 flex flex-col justify-center items-center rounded-lg ",children:[e.jsx("h1",{className:"text-3xl text-white",children:"Register"}),e.jsxs("div",{className:"flex flex-col gap-2 p-5",children:[e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"username",onChange:p=>d(p.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"email",placeholder:"email",onChange:p=>h(p.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"text",placeholder:"Phone number",onChange:p=>b(p.target.value)}),e.jsx("input",{className:"p-1 bg-slate-300 border-none outline-none",type:"password",placeholder:"password",onChange:p=>n(p.target.value)}),e.jsx("label",{htmlFor:"image-upload",children:e.jsx("img",{src:Ee,className:"w-16"})}),e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:p=>x(p.target.files[0])}),e.jsx("textarea",{className:"p-1 bg-slate-300 border-none outline-none resize-none",rows:"2",placeholder:"add any bio here",onChange:p=>u(p.target.value)}),e.jsx("button",{className:"p-2  bg-slate-500 ",onClick:a,children:"Register"}),e.jsx("p",{className:" text-black text-opacity-50 hover:text-opacity-100",children:"Already have account?Login"})]})]})})},Pe=()=>{const{currentUser:r}=s.useContext(L),d=({children:c})=>r?c:e.jsx(ge,{to:"/login/"});return e.jsx("div",{className:" app flex flex-row gap-0 p-5  w-full h-screen  justify-center items-center",children:e.jsx(me,{children:e.jsx(pe,{children:e.jsxs(T,{path:"/",children:[e.jsx(T,{index:!0,element:e.jsx(d,{children:e.jsx(Le,{})})}),e.jsx(T,{path:"login",element:e.jsx(be,{})}),e.jsx(T,{path:"register",element:e.jsx(Fe,{})})]})})})})};xe.createRoot(document.getElementById("root")).render(e.jsx(Ne,{children:e.jsx(ye,{children:e.jsx(he.StrictMode,{children:e.jsx(Pe,{})})})}));
